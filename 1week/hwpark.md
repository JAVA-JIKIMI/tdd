# 저자의 글

### TDD로만 풀어낼 수 없는 프로그래밍
- 보안 소프트웨어 : 결함이 없는 코드, 보안을 지키기 위해 사용하는 방법이 인간 판단에 의존
- 동시성 : 미묘한 동시성 문제들은 코드를 실행하는 것만으로는 확실히 재현할 수 없음

## 책의 구성
1부 Money 예제.
- TDD로 일상적인 모델 코드를 만드는 예제.
- 코딩하기 전에 테스트를 만드는 법과 설계를 유기적으로 키워나가는 방법 배움

2부. xUnit 예제.
- 자동화된 테스트를 위한 프레임워크를 만들고, 그 과정에서 리플랙션이나 예외 등을 포함하는 더 복잡한 로직을 테스트하는 예제.
- 프로그래머 중심 테스팅 툴의 진수인 xUnit 아키텍처 소개(xUnit은 c# 테스팅 프레임워크임)
- 첫번째 예보다 더 작은 단계로 작업하는 방식을 배우며, 자기 참조(self-referencial)의 일종도 접할 것.

3부. 테스트 주도 개발을 위한 패턴들.
- 어떤 테스트를 작성해야 하는가, xUnit에서 어떻게 테스트할 것인가
- 예제에서 사용된 디자인 패턴, 리팩토링 소개

---

# 1장. 다중 통화를 지원하는 Money 객체

객체가 아니라 테스트를 먼저 만들면서 시작한다.

## todo list
- 통화가 다른 두 금액을 더해서 주어진 환율에 맞게 변한 금액을 결과로 얻을 수 있어야 한다.
- 어떤 금액(주가)을 어떤 수(주식의 수)에 곱한 금액을 결과로 얻을 수 있어야 한다.

$5 x 10chf = $10(환율이 2:1인 경우)  
$5 x 2 = $10

[이번 장에서 한 일]
- 작업해야 할 테스트 목록을 만듦
- 말로 된 이야기를 코드로 표현.오퍼레이션이 외부에서 어떻게 보이길 원하는지 말해주는 이야기를 코드로 표현
- stub 구현으로 테스트 컴파일 성공("빨간 막대")
- 메서드에 stub 넣어 테스트 통과 ("초록 막대")
- 돌아가는 코드에서 상수를 변수로 변경하여 점진적 일반화
- 새로운 할일들을 할일 목록에 추가하고 넘어감.

---

# 2장. 타락한 객체
이번 장에서는 TDD 를 적용한 개발 방법론에 대해 얘기한다.

### divide and conquer
- 작동하는 깔끔한 코드를 얻기 위해 나눠서 정복한다.
- "작동하는" -> "깔끔한 코드" 순으로 해결한다.

## 일반적인 TDD 주기
1. 테스트를 작성한다
2. 실행 가능하게 만든다 (초록 막대를 만든다)
3. 올바르게 만든다 (소프트웨어에 저지른 죄악을 수습한다)

## 실무에서 TDD 구현시 사용하는 세가지 방법
- 가짜로 구현하기 : mock method 생성 -> 죄악 청산.
- 명백한 구현하기 : 실제 구현을 입력한다. 모든 일이 자연스럽고 뭘 입력해야 할지 명확할 때에 사용함.
- 삼각측량(triangulation) : 예제를 두개 이상 둔다(5 == 5, 5 != 6). 어떻게 테스트를 구현해야할지 모를때만 사용함.

# 3장. 모두를 위한 평등

### Value Object가 암시하는 것
- 이 책의 예시 : Dollar 
- 모든 연산은 새 객체를 반환해야 한다.
- equals()를 구현해야 한다.

# 4장. 프라이버시
amount 변수를 private 처리함.

# 5장. 솔직히 말하자면
Dollar test method를 복사해 Franc test method를 생성하였고  
copy paste를 활용해 Franc 객체를 생성했다.(추후에 중복제거 필요)

# 6장. 돌아온 '모두를 위한 평등'
- 중복을 정리하는 시간. Money class를 두고 Dollar, Franc가 상속받게 한다.  
- amount 변수를 Money로 이동한다.
- (equals 메서드를 Money 로 옮기기 위해)Dollar, Franc의 equals() 메서드 구현을 일치시켰다.
- 있으면 좋을 것 같은 테스트 코드를 작성한다.  

# 7장. 사과와 오렌지
equals()에서 Franc과 Dollar를 비교할경우 실패하도록 한다.
- 결함을 끄집어내 테스트에 담았다. (같은 화폐일 경우에만 비교 가능하도록 변경.)
- 아직 화폐 Currency 개념은 없는 상태. 아직은 통화 개념을 도입할 충분한 이유가 없다.

# 8장. 객체 만들기
Money 하위 클래스를 정리하고 싶다.  
- 하위클래스에 대한 참조를 factory method로 줄여보자.
```
static Dollar dollar(int amount) {
    return new Dollar(amount);
}
```
- Money.times() 를 비교하는 테스트 코드 작성
- Money에는 times()가 없어서 Money를 abstract class로 변경한다.


# 9장. 우리가 사는 시간(times)
통화 개념을 도입하여 Money의 Dollar, Franc 생성자를 하나로 통일한다.  
times()의 내부 구현도 맞춘다.
- 귀찮고 불필요한 하위 클래스를 제거하기 위해 통화 개념을 도입한다.
- 테스트 코드를 작성 -> 실제 구현
```java
// Money
Money(int amount, String currency) {
    this.amount = amount;
    this.currency = currency;
}
// Dollar
Dollar(int amount, String currency) {
    this.amount = amount;
    this.currency = currency;
}
Money times() {
    return Money.dollar(amount * multiplier);
}
```

** 지금 하는일이 끝나기 전에 다른 일을 해도 되나? 1 depth(하던일 > 하던일) 까지는 괜찮다. 2 depth는 안됨.

### TDD 작업단위 조정?
종종걸음으로 진행하는 것이 답답하면 보폭을 조금 넓혀라.  
성큼성큼 걷는 것이 불안하면 보폭을 줄여라.

# 10장. 흥미로운 시간(times)
Dollar, Franc의 times() 구현을 일치시키고 제거한 후 Money에 times()를 만든다.
- 이 과정에서 코드가 잘 작동하는지 머리로 5-10분 고민할 문제를 test code를 돌려서 10초 안에 확인하자.